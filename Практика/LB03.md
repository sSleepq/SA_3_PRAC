# Лабораторная работа №3  
**Тема:** Настройка базового удалённого доступа на Ubuntu Server  
**Оборудование:** Ubuntu Server, Windows 10, гипервизор VMware Workstation  

## Цель работы  
Настроить безопасный удалённый доступ к Ubuntu Server по SSH с ограничением прав и усиленной аутентификацией.

## Исходные данные

- **Ubuntu Server**:  
  - Интерфейс `ens33` (NAT): динамический IP (DHCP)  
  - Интерфейс `ens34` (LAN Segment): `$10.10.13.1/24$`  
- **Windows 10** (клиент):  
  - Интерфейс (LAN Segment): `$10.10.13.x/24$` (например, `$10.10.13.2$`)  
  - Для подключения используется SSH‑клиент (PuTTY/OpenSSH)

> **Примечание:** Имена интерфейсов (`ens33`, `ens34`) могут отличаться. Уточняйте их командой `ip a`.

## Ход работы

### 1. Создание пользователя `sshuser`

1. Создайте пользователя с UID `2026`:  
   ```bash
   sudo useradd -m -u 2026 -s /bin/bash sshuser
   ```

2. Задайте пароль `P@ssw0rd`:  
   ```bash
   echo "sshuser:P@ssw0rd" | sudo chpasswd
   ```

3. Добавьте пользователя в группу `sudo`:  
   ```bash
   sudo usermod -aG sudo sshuser
   ```

4. Настройте беспарольный доступ к `sudo`:  
   ```bash
   echo "sshuser ALL=(ALL) NOPASSWD: ALL" | sudo tee /etc/sudoers.d/sshuser
   ```

5. Проверьте права:  
   ```bash
   sudo -l -U sshuser
   ```

### 2. Настройка SSH-сервера

#### 2.1. Установка OpenSSH Server

Если сервер SSH не установлен:  
```bash
sudo apt update
sudo apt install openssh-server -y
```

Запустите сервис:  
```bash
sudo systemctl enable ssh
sudo systemctl start ssh
```

#### 2.2. Редактирование конфигурации SSH

Откройте файл конфигурации:  
```bash
sudo nano /etc/ssh/sshd_config
```

Внесите изменения:

1. Измените порт на `2026`:  
   ```
   Port 2026
   ```

2. Разрешите вход только пользователю `sshuser`:  
   ```
   AllowUsers sshuser
   ```

3. Ограничьте количество попыток входа до 2:  
   ```
   MaxAuthTries 2
   ```

4. Включите баннер авторизации:  
   ```
   Banner /etc/issue.net
   ```

5. Отключите вход от имени `root`:  
   ```
   PermitRootLogin no
   ```

6. Сохраните файл и перезапустите SSH:  
   ```bash
   sudo systemctl restart ssh
   ```

#### 2.3. Создание баннера

Создайте файл баннера:  
```bash
sudo nano /etc/issue.net
```

Добавьте текст:  
```
**********************************************
*  Authorized access only             *
*  Unauthorized use is prohibited     *
**********************************************
```

### 3. Настройка брандмауэра (UFW)

1. Разрешите SSH на порту `2026`:  
   ```bash
   sudo iptables -I INPUT -p tcp --dport 2026 -j ACCEPT
   ```

### 4. Проверка удалённого доступа

#### 4.1. С Windows 10

1. Установите SSH‑клиент (например, PuTTY или используйте встроенный OpenSSH в Windows 10+).
2. Подключитесь к серверу:  
   - **Хост:** `$10.10.13.1$`  
   - **Порт:** `2026`  
   - **Пользователь:** `sshuser`  
   - **Пароль:** `P@ssw0rd` (если включена парольная аутентификация)

3. Пример команды для OpenSSH в PowerShell:  
   ```powershell
   ssh sshuser@10.10.13.1 -p 2026
   ```

4. После входа проверьте права `sudo`:  
   ```bash
   sudo whoami
   ```

#### 4.2. Проверка баннера

При подключении должен отображаться баннер:  
```
**********************************************
*  Authorized access only             *
*  Unauthorized use is prohibited     *
**********************************************
```

#### 4.3. Проверка ограничений

1. Попробуйте подключиться с неверным паролем — после 2 попыток соединение должно разрываться.
2. Попробуйте войти под другим пользователем — доступ должен быть запрещён.

### 5. Дополнительная проверка безопасности

1. Проверьте открытые порты:  
   ```bash
   sudo ss -tulnp | grep 2026
   ```

2. Убедитесь, что SSH слушает только на нужных интерфейсах:  
   ```bash
   sudo grep "ListenAddress" /etc/ssh/sshd_config
   ```

3. Проверьте логи SSH:  
   ```bash
   sudo journalctl -u ssh -f
   ```

## Результаты работы

1. Создан пользователь `sshuser` с UID `2026` и паролем `P@ssw0rd`.
2. Пользователь `sshuser` имеет беспарольный доступ к `sudo`.
3. SSH‑сервер настроен на порт `2026`.
4. Разрешён вход только пользователю `sshuser`.
5. Ограничено количество попыток входа до 2.
6. Настроен баннер «Authorized access only».
7. Брандмауэр (UFW) разрешает подключения только на порт `2026`.
8. Удаленный доступ успешно протестирован с Windows 10.

## Выводы

В ходе лабораторной работы:
- Настроен безопасный SSH‑доступ с изменением стандартного порта.
- Ограничен круг пользователей, имеющих право на подключение.
- Усилена безопасность за счёт ограничения попыток входа и баннера.
- Настроен брандмауэр для контроля доступа.
- Проверено функционирование удалённого доступа и прав `sudo`.

Работа выполнена успешно.