# Лабораторная работа №4  
**Тема:** Настройка DHCP‑сервера на Ubuntu Server  
**Цель:** Освоить установку и конфигурацию DHCP‑сервера для автоматического распределения IP‑адресов в локальной сети.


## 1. Исходные данные

- **Сервер:** Ubuntu Server  
- **Сетевой интерфейс для DHCP:** `ens34` (LAN‑сегмент)  
- **Подсеть:** `10.10.13.0/24`  
- **Диапазон выдаваемых адресов:** `10.10.13.10` – `10.10.13.100`  
- **Шлюз по умолчанию:** `10.10.13.1`  
- **DNS‑серверы:** `10.10.13.1`  
- **Время аренды адреса:** 8 часов  

## 2. Подготовка сервера

### 2.1. Обновление системы
```bash
sudo apt update
sudo apt upgrade -y
```

### 2.2. Проверка сетевого интерфейса
Убедитесь, что интерфейс `ens34` активен и имеет статический IP:
```bash
ip a show ens34
```
Ожидаемый результат:
```
inet 10.10.13.1/24 brd 10.10.13.255 scope global ens34
```

## 3. Установка DHCP‑сервера

Установите пакет `isc-dhcp-server`:
```bash
sudo apt install isc-dhcp-server -y
```

## 4. Базовая конфигурация DHCP

### 4.1. Редактирование основного конфига
Откройте файл:
```bash
sudo nano /etc/dhcp/dhcpd.conf
```

Очистите файл и вставьте конфигурацию:
```conf
# Глобальные параметры
option domain-name "localnet";
option domain-name-servers 10.10.13.1;
default-lease-time 28800;    # 8 часов
max-lease-time 43200;      # 12 часов

# Описание подсети
subnet 10.10.13.0 netmask 255.255.255.0 {
  range 10.10.13.10 10.10.13.100;
  option routers 10.10.13.1;
  option subnet-mask 255.255.255.0;
  option broadcast-address 10.10.13.255;
  option domain-name-servers 10.10.13.1;
}
```

### 4.2. Настройка интерфейса для DHCP
Откройте:
```bash
sudo nano /etc/default/isc-dhcp-server
```

Укажите интерфейс:
```conf
INTERFACESv4="ens34"
```

## 5. Запуск и проверка сервиса

### 5.1. Запуск DHCP‑сервера
```bash
sudo systemctl start isc-dhcp-server
sudo systemctl enable isc-dhcp-server
```

### 5.2. Проверка статуса
```bash
sudo systemctl status isc-dhcp-server
```
Ожидайте статус `active (running)`.

### 5.3. Просмотр логов
```bash
sudo journalctl -u isc-dhcp-server -f
```
Ищите сообщения типа:
```
DHCPDISCOVER from xx:xx:xx:xx:xx:xx via ens34
DHCPOFFER on 10.10.13.10 to xx:xx:xx:xx:xx:xx via ens34
```

## 6. Тестирование DHCP‑сервера

### 6.1. Подготовка клиента (Windows 10)
1. Откройте **Параметры сети и Интернет** → **Настройка параметров адаптера**.  
2. В свойствах IPv4 выберите **Получить IP‑адрес автоматически** и **Получить адрес DNS‑сервера автоматически**.  
3. Обновите настройки:  
   ```cmd
   ipconfig /release
   ipconfig /renew
   ```

### 6.2. Проверка полученных параметров
На клиенте выполните:
```cmd
ipconfig
```
Ожидаемый результат:
- IP‑адрес в диапазоне `10.10.13.10` – `10.10.13.100`  
- Шлюз: `10.10.13.1`  
- DNS: `8.8.8.8`, `8.8.4.4`


## 7. Дополнительные настройки (опционально)

### 7.1. Резервация IP для конкретного MAC
Добавьте в `/etc/dhcp/dhcpd.conf`:
```conf
host printer {
  hardware ethernet 00:11:22:33:44:55;
  fixed-address 10.10.13.50;
}
```
Перезапустите сервер:
```bash
sudo systemctl restart isc-dhcp-server
```

### 7.2. Просмотр выданных адресов
```bash
sudo lease
```
Или проверьте файл:
```bash
cat /var/lib/dhcp/dhcpd.leases
```

## 8. Устранение неполадок

### 8.1. Типичные проблемы
- **Сервер не запускается:** Проверьте синтаксис конфига:  
  ```bash
  sudo dhcpd -t -cf /etc/dhcp/dhcpd.conf
  ```
- **Клиенты не получают IP:** Убедитесь, что интерфейс `ens34` активен и не заблокирован UFW.  
- **Конфликт IP:** Проверьте, нет ли другого DHCP‑сервера в сети.

### 8.2. Проверка портов
```bash
sudo ss -tulnp | grep :67
```
Должен быть открыт UDP‑порт `67`.

## 9. Результаты работы

1. Установлен и настроен DHCP‑сервер `isc-dhcp-server`.  
2. Сервер раздаёт IP‑адреса в подсети `10.10.13.0/24` с диапазоном `10.10.13.10` – `10.10.13.100`.  
3. Клиенты (Windows 10 и Linux) успешно получают IP, шлюз и DNS автоматически.  
4. Время аренды адресов — 8 часов.  
5. Сервер запущен и работает в режиме демона.  

## 10. Выводы

В ходе лабораторной работы:  
- Освоена установка DHCP‑сервера на Ubuntu.  
- Настроена выдача IP‑адресов, шлюза и DNS для локальной сети.  
- Протестировано получение адресов клиентами.  
- Рассмотрены дополнительные настройки (резервация IP, просмотр логов).  
- Изучены методы диагностики неполадок.  

Работа выполнена успешно.
